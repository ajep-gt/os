---
name: fedora-kinoite
description: Fedora Kinoite image.

base-image: quay.io/fedora-ostree-desktops/kinoite
image-version: 41

modules:
  - type: files
    files:
      - source: system
        destination: / # copies files/system/* (* means everything inside it) into your image's root folder /

  - type: script
    scripts:
      - installrpmfusion.sh
      - rpmostreeoverride.sh

  - from-file: common-packages.yml
  - from-file: kinoite-packages.yml
  - from-file: hyprland-packages.yml
  - from-file: fonts.yml
  - from-file: flatpaks.yml

  - type: copy
    from: docker.io/rclone/rclone
    src: /usr/local/bin/rclone
    dest: /usr/bin
  
  - type: script
    snippets:
      - ln -s /usr/bin/rclone /usr/sbin/mount.rclone
      - semanage port -m -t websm_port_t -p tcp 9191

  - type: systemd
    system:
      enabled:
        - sshd.service
        - cockpit.socket
        - podman.socket
    user:
      enabled:
        - podman.socket

  - type: chezmoi
    repository: https://github.com/ajep-gt/dotfiles.git
    all-users: false # make users have to enable chezmoi manually
    file-conflict-policy: replace # override changed files with those from the repo

  - type: signing # this sets up the proper policy & signing files for signed images to work fully
